---
title: "BST 260 hw3"
author: "liuxiaoxuan"
date: "2019/10/31"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}

```

## Question1
Ans: As shown from the line plot, the life expectancy in the United States goes up as year increases. And the slope is the highest in 1970s, after 1980, the increase rate fluctuated a little, but maitains a increasing trend.

```{r,echo=FALSE}
library(tidyverse)
library(shiny)
#library(forcats)
library(dslabs)
library(ggplot2)
data(gapminder)
shinyApp(
ui <- fluidPage(
  selectInput(inputId = "country", label = "Select a country",
              choices = as.list('United States')),
  plotOutput("linePlot")
),

server <- function(input, output){
    output$linePlot <- renderPlot({
      gapminder %>% filter(country == input$country) %>%
        ggplot(aes(x = year, y = life_expectancy)) +
        geom_line() +
        xlab("year") +
        ylab("life_expectancy")
    })
  }
)
```

## Question2

You can also embed plots, for example:

```{r, echo=FALSE}

ui <- fluidPage(
  selectInput(inputId = "country", label = "Select a country",
              choices = as.list(levels(gapminder$country))),
  plotOutput("linePlot")
)

server <- function(input, output){
    output$linePlot <- renderPlot({
      gapminder %>% filter(country %in% c(input$country,'United States')) %>%
        ggplot(aes(x = year, y = life_expectancy,colour = country)) +
        geom_line() +
        xlab("year") +
        ylab("life_expectancy")
    })
  }

```
## Question3
3.Compare life expectancy over time in the United States with life expectancy over time in Switzerland. Then compare the United States and Swaziland (renamed Eswatini in 2018, but referred to as Swaziland in the gapminder dataset).
###Ans: 
  The life expectancy over time in the United States and Switzerland has similar upward trend, the slope of each corresponding time period is roughly the same, except for years after 2000. In years later than 2000, Switzerland shows a higher increase than United States. The life expectancy of United States is obviously higher than Swaziland. Rather than a increasing trend, the life expectancy in Swaziland went up from 1960 to 1993 and dropped down quickly until 2005, and then went up.
```{r,echo=TRUE}
gapminder %>% filter(country %in% c('Switzerland','United States')) %>%
        ggplot(aes(x = year, y = life_expectancy,colour = country)) +
        geom_line() +
        xlab("year") +
        ylab("life_expectancy")
gapminder %>% filter(country %in% c('Swaziland','United States')) %>%
        ggplot(aes(x = year, y = life_expectancy,colour = country)) +
        geom_line() +
        xlab("year") +
        ylab("life_expectancy")
```

##Question4.
 Use tabsetPanel and tabPanel to make two tabs for your Shiny app. Move your time series plot and country selector widget from Questions 1-3 to the first tab
```{r}
ui = fluidPage(
    # Change theme to darkly
    theme = shinythemes::shinytheme("darkly"),
    # Application title
    titlePanel("My More Advanced Shiny App"),
    
    # Create an app with 2 tabs
    tabsetPanel(
      # First tab: 
      # Scatter plot that compares life expectancy and fertility
      # for each country over time with an animated bar for the years
     
      # Second tab: tile plot of infectious diseases
      # Include dropdown menu of diseases to choose from 
      tabPanel("Gapminder",
               sidebarLayout(
                 sidebarPanel(
                   # Paragraph with some text about vaccines and the data source
                   # strong("Vaccines") makes the word Vaccines bold
                   p("line plots of  year and life expectancy for us and other countries."),
                   
                   # Adding br() will add space between the text above and the dropdown
                   # menu below
                   br(),
                   
                   # Dropdown menu that allows the user to choose a disease
                   selectInput("country", label = "Select country",
                               choices = as.list(levels(gapminder$country)))
                 ),
                 
                 # Show a tile plot of disease rate across states and years
                 mainPanel(
                   plotOutput("linePlot")
                 )
               ))
    )
  )
  
  server = function(input, output) {
    
    # Scatterplot of fertility rate vs life expectancy
    output$linePlot <- renderPlot({
      gapminder %>% filter(country %in% c(input$country,'United States')) %>%
        ggplot(aes(x = year, y = life_expectancy,colour = country)) +
        geom_line() +
        xlab("year") +
        ylab("life_expectancy")
    })
    
  }

```
 
##Question5
5.In the second tab, make a scatterplot of life expectancy against fertility rate, filtering for the year 2000 and coloring by continent. What trends do you see?
Ans: From the plot we can see that Africa has highest fertility and lowest life expectancy, Europe has lower fetility and highest(almostly) life expectancy, Asia and Americas are more scattered distributed. In both Asia and Americas, they have relatively higher life expectancy, but the fetility ranges from 1.5 to 4, and some extremely high fertility in Asia.It may because the population of Asia is the highest, and a larger population leads to larger discrepancy. 
```{r}

  ui = fluidPage(
    # Change theme to darkly
    theme = shinythemes::shinytheme("darkly"),
    # Application title
    titlePanel("My More Advanced Shiny App"),
    
    # Create an app with 2 tabs
    tabsetPanel(
      # First tab: 
      # Scatter plot that compares life expectancy and fertility
      # for each country over time with an animated bar for the years
     
      # Second tab: tile plot of infectious diseases
      # Include dropdown menu of diseases to choose from 
      tabPanel("Gapminder",
               sidebarLayout(
                 sidebarPanel(
                   # Paragraph with some text about vaccines and the data source
                   # strong("Vaccines") makes the word Vaccines bold
                   p("line plots of  year and life expectancy for us and other countries."),
                   
                   # Adding br() will add space between the text above and the dropdown
                   # menu below
                   br(),
                   
                   # Dropdown menu that allows the user to choose a disease
                   selectInput("country", label = "Select country",
                               choices = as.list(levels(gapminder$country)))
                 ),
                 mainPanel(
                   plotOutput("linePlot")
                 )
               )),
      tabPanel("tab2",
               sidebarLayout(
                 sidebarPanel(
                   p("In the second tab, make a scatterplot of life expectancy against fertility rate,
                     filtering for the year 2000 and coloring by continent."),
                   br()),
                 mainPanel(
                   plotOutput("scatterPlot"))
                 
    ))
  ))
  
  server = function(input, output) {
    
    # Scatterplot of fertility rate vs life expectancy
    output$linePlot <- renderPlot({
      gapminder %>% filter(country %in% c(input$country,'United States')) %>%
        ggplot(aes(x = year, y = life_expectancy,colour = country)) +
        geom_line() +
        xlab("year") +
        ylab("life_expectancy")
    })
    output$scatterPlot = renderPlot({
      # Filter year to be the input year from the slider
      gapminder %>% filter(year ==2000 & !is.na(fertility)) %>%
        ggplot(aes(fertility, life_expectancy, color = continent, size = population/10^6)) +
        geom_point(alpha = 0.5) +
        xlab("Fertility (Average number of children per woman)") +
        ylab("Life expectancy (Years)") +
        
        # Set x and y axis limits to keep the same for each year
        scale_x_continuous(breaks = seq(0, 9), limits = c(1, 8)) +
        scale_y_continuous(breaks = seq(30, 85, 5), limits = c(30, 85)) +
        # Make the legend titles nicer
        scale_color_discrete(name = "Continent") +
        scale_size_continuous(name = "Population in millions") +
        
        # Change the title of the plot for each year
        # Returns a character vector containing a formatted combination 
        # of text and variable values
        ggtitle(sprintf("Life expectancy vs. fertility in %d", input$year)) +
        theme_bw()
    })
    
  }
  
```

##Question 6
6.Still in the second tab, use sliderInput to add a slider widget that allows the user to select year. Update your scatterplot so that it plots life expectancy against fertility rate for the selected year. Optional: experiment with the arguments of sliderInput to make your widget look nice (e.g., get rid of the comma, make sure that the years are always integers, etc.).
```{r}

  ui = fluidPage(
  # Change theme to darkly
  theme = shinythemes::shinytheme("darkly"),
  # Application title
  titlePanel("My More Advanced Shiny App"),
  
  # Create an app with 2 tabs
  tabsetPanel(
    # First tab: 
    # Scatter plot that compares life expectancy and fertility
    # for each country over time with an animated bar for the years
    
    # Second tab: tile plot of infectious diseases
    # Include dropdown menu of diseases to choose from 
    tabPanel("life_exp vs year",
             sidebarLayout(
               sidebarPanel(
                 # Paragraph with some text about vaccines and the data source
                 # strong("Vaccines") makes the word Vaccines bold
                 p("line plots of  year and life expectancy for us and other countries."),
                 
                 # Adding br() will add space between the text above and the dropdown
                 # menu below
                 br(),
                 
                 # Dropdown menu that allows the user to choose a disease
                 selectInput("country", label = "Select country",
                             choices = as.list(levels(gapminder$country)))
               ),
               mainPanel(
                 plotOutput("linePlot")
               )
             )),
    tabPanel("life_exp vs fertility",
             sidebarLayout(
               sidebarPanel(
                 p("In the second tab, make a scatterplot of life expectancy against fertility rate,
                     filtering for the year and coloring by continent."),
                 br(),
                 sliderInput(inputId = "year",
                           label = "Choose a year",
                           min = 1960, max = 2018,
                           value = 1960, 
                           step = 1,sep = "",
                                  # keep years in year format and not 1,960 format
                           ticks = FALSE,  # don't show tick marks on slider bar
                           animate = TRUE)),
               mainPanel(
                 plotOutput("scatterPlot"))
               
             ))
  ))


server = function(input, output) {
  
  # Scatterplot of fertility rate vs life expectancy
  output$linePlot <- renderPlot({
    gapminder %>% filter(country %in% c(input$country,'United States')) %>%
      ggplot(aes(x = year, y = life_expectancy,colour = country)) +
      geom_line() +
      xlab("year") +
      ylab("life_expectancy")
  })
  output$scatterPlot = renderPlot({
    # Filter year to be the input year from the slider
    gapminder %>% filter(year %in% input$year  & !is.na(fertility)) %>%
      ggplot(aes(fertility, life_expectancy, color = continent, size = population/10^6)) +
      geom_point(alpha = 0.5) +
      xlab("Fertility (Average number of children per woman)") +
      ylab("Life expectancy (Years)") +
      
      # Set x and y axis limits to keep the same for each year
      scale_x_continuous(breaks = seq(0, 9), limits = c(1, 8)) +
      scale_y_continuous(breaks = seq(30, 85, 5), limits = c(30, 85)) +
      # Make the legend titles nicer
      scale_color_discrete(name = "Continent") +
      scale_size_continuous(name = "Population in millions") +
      
      # Change the title of the plot for each year
      # Returns a character vector containing a formatted combination 
      # of text and variable values
      ggtitle(sprintf("Life expectancy vs. fertility in %d", input$year)) +
      theme_bw()
  })
}


```

##Question7
7.Make your scatterplot interactive by allowing the user to click on a point to get more information about the observation. You can do this by including calls to plotOutput in the UI and nearPoints in the server; a demo is available here. When the user clicks somewhere on the plot, your app should print a data frame with the corresponding life expectancy, fertility, country, and continent for all points near the click.
```{r}

  ui <- fluidPage(
  fluidRow(
  column(width = 4,
         sliderInput(inputId = "year",
                     label = "Choose a year",
                     min = 1960, max = 2018,
                     value = 1960, 
                     step = 1,sep = "",
                     # keep years in year format and not 1,960 format
                     ticks = FALSE,  # don't show tick marks on slider bar
                     animate = TRUE),
         plotOutput("plot1", height = 300,
                    # Equivalent to: click = clickOpts(id = "plot_click")
                    click = "plot1_click")
  )
),
fluidRow(
  column(width = 6,
         h4("Points near click"),
         verbatimTextOutput("click_info")
  )
)
)

  server <- function(input, output) {
  output$plot1 <- renderPlot({
    gapminder %>% filter(year %in% input$year  & !is.na(fertility)) %>%
      ggplot(aes(fertility, life_expectancy, color = continent, size = population/10^6)) +
      geom_point(alpha = 0.5) +
      xlab("Fertility (Average number of children per woman)") +
      ylab("Life expectancy (Years)") +
      
      # Make the legend titles nicer
      scale_color_discrete(name = "Continent") +
      scale_size_continuous(name = "Population in millions") +
      
      # Change the title of the plot for each year
      # Returns a character vector containing a formatted combination 
      # of text and variable values
      ggtitle(sprintf("Life expectancy vs. fertility in %d", input$year)) +
      theme_bw()})
  output$click_info <- renderPrint({
    # Because it's a ggplot2, we don't need to supply xvar or yvar; if this
    # were a base graphics plot, we'd need those.
    nearPoints(gapminder[,c('country','continent','life_expectancy','fertility')], input$plot1_click, addDist = TRUE)
  })
}
```

##Question8
8.Look at your scatterplot of life expectancy against fertility rate with the year selected as 1980. Do you see a major outlier? Does the outlier have an unusual value for life expectancy and fertility, or for only one of the variables? Click on this point to get more information. What country is the outlier?
Ans: I find one outlier, it has an unusual low life expetancy. The country is Cambodia.

```{r}

  ui <- fluidPage(
  fluidRow(
  column(width = 4,
         sliderInput(inputId = "year",
                     label = "Choose a year",
                     min = 1960, max = 2018,
                     value = 1960, 
                     step = 1,sep = "",
                     # keep years in year format and not 1,960 format
                     ticks = FALSE,  # don't show tick marks on slider bar
                     animate = TRUE),
         plotOutput("plot1", height = 300,
                    # Equivalent to: click = clickOpts(id = "plot_click")
                    click = "plot1_click")
  )
),
fluidRow(
  column(width = 6,
         h4("Points near click"),
         verbatimTextOutput("click_info")
  )
)
)

  server <- function(input, output) {
  output$plot1 <- renderPlot({
    gapminder %>% filter(year %in% input$year  & !is.na(fertility)) %>%
      ggplot(aes(fertility, life_expectancy, color = continent, size = population/10^6)) +
      geom_point(alpha = 0.5) +
      xlab("Fertility (Average number of children per woman)") +
      ylab("Life expectancy (Years)") +
      
      # Make the legend titles nicer
      scale_color_discrete(name = "Continent") +
      scale_size_continuous(name = "Population in millions") +
      
      # Change the title of the plot for each year
      # Returns a character vector containing a formatted combination 
      # of text and variable values
      ggtitle(sprintf("Life expectancy vs. fertility in %d", input$year)) +
      theme_bw()})
  output$click_info <- renderPrint({
    # Because it's a ggplot2, we don't need to supply xvar or yvar; if this
    # were a base graphics plot, we'd need those.
    nearPoints(gapminder[,c('country','continent','life_expectancy','fertility')], input$plot1_click, addDist = TRUE)
  })
}
```

##Question 9
9.How has life expectancy changed over time for the outlier country from Question 8? You can use your time series plot in the first tab to answer this question.
Ans: As shown from the line plot, the life expectancy of Cambodia dropped down from 45 to below 20 during 1970s, and went up after 1978. After reaching 55 in about 1985, the increase rate calm down and it remained constant for some years and then went up slowly.
```{r}
gapminder %>% filter(country=='Cambodia') %>%
      ggplot(aes(x = year, y = life_expectancy)) +
      geom_line() +
      xlab("year") +
      ylab("life_expectancy")
```

##Question 10

10.Suggest another interactive feature that you could incorporate into your Shiny app, perhaps involving one (or more) of the other variables in the gapminder dataset. What R/shiny function(s) would you use to implement this feature? Optional: add the feature to your Shiny app, as long as it doesn’t interfere with the functionality of the non-optional parts of this assignment.

Ans: I also want to know the gdp of the country I clicked. This can be done by using the verbatimTextOutput() function in the ui function and renderText({ }) function in the server function.
```{r}

```

 
Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
